<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : AI
Description : Implementation of AI player based on the MCTS algorithm
-}</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">AI</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="AI.html#Hiperparameters"><span class="hs-identifier">Hiperparameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier">Generator</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="AI.html#newGenerator"><span class="hs-identifier">newGenerator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="AI.html#getNextMove"><span class="hs-identifier">getNextMove</span></a></span><span>
</span><span id="line-10"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Game.html"><span class="hs-identifier">Game</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Random</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">-- | Type representing MCTS algorithm hiperparameters</span><span>
</span><span id="line-19"></span><span class="hs-keyword">data</span><span> </span><span id="Hiperparameters"><span class="annot"><a href="AI.html#Hiperparameters"><span class="hs-identifier hs-var">Hiperparameters</span></a></span></span><span> </span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Random"><span class="annot"><a href="AI.html#Random"><span class="hs-identifier hs-var">Random</span></a></span></span><span> </span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MCTS"><span class="annot"><a href="AI.html#MCTS"><span class="hs-identifier hs-var">MCTS</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-22"></span><span>        </span><span class="hs-comment">-- | UCB 'c' balance parameter</span><span>
</span><span id="line-23"></span><span>        </span><span id="balance"><span class="annot"><span class="annottext">Hiperparameters -&gt; Float
</span><a href="AI.html#balance"><span class="hs-identifier hs-var hs-var">balance</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="hs-comment">-- | number of MCTS iterations</span><span>
</span><span id="line-25"></span><span>        </span><span id="nIterations"><span class="annot"><span class="annottext">Hiperparameters -&gt; Int
</span><a href="AI.html#nIterations"><span class="hs-identifier hs-var hs-var">nIterations</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- | Random number generator state used by the AI algorithm.</span><span>
</span><span id="line-30"></span><span class="hs-keyword">type</span><span> </span><span id="Generator"><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-var">Generator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- | For a given seed returns new generator.</span><span>
</span><span id="line-34"></span><span class="annot"><a href="AI.html#newGenerator"><span class="hs-identifier hs-type">newGenerator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span>
</span><span id="line-35"></span><span id="newGenerator"><span class="annot"><span class="annottext">newGenerator :: Int -&gt; Generator
</span><a href="AI.html#newGenerator"><span class="hs-identifier hs-var hs-var">newGenerator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Generator
</span><span class="hs-identifier hs-var">mkStdGen</span></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-comment">-- | Data type representing a MCTS game tree.</span><span>
</span><span id="line-39"></span><span class="hs-comment">--   Does not store game states. Game states in the tree can be recreated with provided correct game state for the root. </span><span>
</span><span id="line-40"></span><span class="hs-comment">--   Therefore MCTS tree representation assumes game state for the root is stored independently. </span><span>
</span><span id="line-41"></span><span class="hs-keyword">data</span><span> </span><span id="MCTSNode"><span class="annot"><a href="AI.html#MCTSNode"><span class="hs-identifier hs-var">MCTSNode</span></a></span></span><span> </span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Node"><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-var">Node</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-43"></span><span>        </span><span class="hs-comment">-- | Player whose turn it is in this game node.</span><span>
</span><span id="line-44"></span><span>        </span><span id="player"><span class="annot"><span class="annottext">MCTSNode -&gt; Player
</span><a href="AI.html#player"><span class="hs-identifier hs-var hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Game.html#Player"><span class="hs-identifier hs-type">Game.Player</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="hs-comment">-- | Number of games won by 'player' in the playouts originating from the subtree of this node.</span><span>
</span><span id="line-46"></span><span>        </span><span id="won"><span class="annot"><span class="annottext">MCTSNode -&gt; Int
</span><a href="AI.html#won"><span class="hs-identifier hs-var hs-var">won</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>        </span><span class="hs-comment">-- | Number of games lost by 'player' in the playouts originating from the subtree of this node.</span><span>
</span><span id="line-48"></span><span>        </span><span id="lost"><span class="annot"><span class="annottext">MCTSNode -&gt; Int
</span><a href="AI.html#lost"><span class="hs-identifier hs-var hs-var">lost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>        </span><span class="hs-comment">-- | Number of draws in the playouts originating from the subtree of this node.</span><span>
</span><span id="line-50"></span><span>        </span><span id="draws"><span class="annot"><span class="annottext">MCTSNode -&gt; Int
</span><a href="AI.html#draws"><span class="hs-identifier hs-var hs-var">draws</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>        </span><span class="hs-comment">-- | List of children edges. </span><span>
</span><span id="line-52"></span><span>        </span><span class="hs-comment">--   Each edge is represented by pair ('move', 'node'), where 'move' is move leading to the child state and 'node' is child's MCTSNode. </span><span>
</span><span id="line-53"></span><span>        </span><span class="hs-comment">--   Applying move to the node's game state produces child's game state.</span><span>
</span><span id="line-54"></span><span>        </span><span id="children"><span class="annot"><span class="annottext">MCTSNode -&gt; [(Int, MCTSNode)]
</span><a href="AI.html#children"><span class="hs-identifier hs-var hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Game.html#Move"><span class="hs-identifier hs-type">Game.Move</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="AI.html#MCTSNode"><span class="hs-identifier hs-type">MCTSNode</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- | Returns a completly random move when only if there is one possible for a given game state. </span><span>
</span><span id="line-59"></span><span class="hs-comment">--   Just move, when there is one, Nothing otherwise.</span><span>
</span><span id="line-60"></span><span class="hs-comment">--   O(n * log(m + n)), where (m, n) is board size</span><span>
</span><span id="line-61"></span><span class="annot"><a href="AI.html#getRandomMove"><span class="hs-identifier hs-type">getRandomMove</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Game.html#GameState"><span class="hs-identifier hs-type">GameState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Game.html#Move"><span class="hs-identifier hs-type">Move</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span id="getRandomMove"><span class="annot"><span class="annottext">getRandomMove :: GameState -&gt; Generator -&gt; (Maybe Int, Generator)
</span><a href="AI.html#getRandomMove"><span class="hs-identifier hs-var hs-var">getRandomMove</span></a></span></span><span> </span><span id="local-6989586621679211318"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211318"><span class="hs-identifier hs-var">gameState</span></a></span></span><span> </span><span id="local-6989586621679211317"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211317"><span class="hs-identifier hs-var">generator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; [Int]
</span><a href="Game.html#availableMoves"><span class="hs-identifier hs-var">Game.availableMoves</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211318"><span class="hs-identifier hs-var">gameState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-64"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211317"><span class="hs-identifier hs-var">generator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>        </span><span id="local-6989586621679211315"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679211315"><span class="hs-identifier hs-var">moves</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-66"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679211306"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211306"><span class="hs-identifier hs-var">rand</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211305"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211305"><span class="hs-identifier hs-var">nextGenerator</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Generator -&gt; (Int, Generator)
forall a g. (Random a, RandomGen g) =&gt; (a, a) -&gt; g -&gt; (a, g)
</span><span class="hs-identifier hs-var">randomR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679211315"><span class="hs-identifier hs-var">moves</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211317"><span class="hs-identifier hs-var">generator</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-67"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679211315"><span class="hs-identifier hs-var">moves</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int -&gt; Int
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211306"><span class="hs-identifier hs-var">rand</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211305"><span class="hs-identifier hs-var">nextGenerator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>    </span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | Simulate one random playout. </span><span>
</span><span id="line-71"></span><span class="hs-comment">--   Light playout - moves chosen completely randomly.</span><span>
</span><span id="line-72"></span><span class="hs-comment">--   Can be extended to heavy playout.</span><span>
</span><span id="line-73"></span><span class="hs-comment">--   Takes game state - a starting state for the simulation and a random generator.</span><span>
</span><span id="line-74"></span><span class="hs-comment">--   Returns who wins the playout - Just Red / Just Blue / Nothing when its a draw.</span><span>
</span><span id="line-75"></span><span class="hs-comment">--   Tail recursive and strict.</span><span>
</span><span id="line-76"></span><span class="hs-comment">--   O(2 * (2(m-k)(n-k) + m(n-k) + n(m-k)) * k * log(m*n) * g), where (m,n,k) is board setting, and g is number of played moves until the playout ends</span><span>
</span><span id="line-77"></span><span class="annot"><a href="AI.html#simulation"><span class="hs-identifier hs-type">simulation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Game.html#GameState"><span class="hs-identifier hs-type">GameState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Game.html#Player"><span class="hs-identifier hs-type">Player</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span id="simulation"><span class="annot"><span class="annottext">simulation :: GameState -&gt; Generator -&gt; (Maybe Player, Generator)
</span><a href="AI.html#simulation"><span class="hs-identifier hs-var hs-var">simulation</span></a></span></span><span> </span><span id="local-6989586621679211300"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211300"><span class="hs-identifier hs-var">gameState</span></a></span></span><span> </span><span id="local-6989586621679211299"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211299"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Maybe Player
</span><a href="Game.html#whoWins"><span class="hs-identifier hs-var">Game.whoWins</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211300"><span class="hs-identifier hs-var">gameState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="annottext">Maybe Player
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- No one won yet</span><span>
</span><span id="line-81"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span>
</span><span id="line-82"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679211297"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679211297"><span class="hs-identifier hs-var">maybeMove</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211296"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211296"><span class="hs-identifier hs-var">nextGen</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Generator -&gt; (Maybe Int, Generator)
</span><a href="AI.html#getRandomMove"><span class="hs-identifier hs-var">getRandomMove</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211300"><span class="hs-identifier hs-var">gameState</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211299"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-83"></span><span>            </span><span class="hs-keyword">in</span><span>
</span><span id="line-84"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679211297"><span class="hs-identifier hs-var">maybeMove</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span>
</span><span id="line-85"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Player
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- there are no possible moves from this state so its a draw</span><span>
</span><span id="line-86"></span><span>                                </span><span class="annot"><span class="annottext">Generator -&gt; Generator
</span><a href="AI.html#nextGeneratorState"><span class="hs-identifier hs-var">nextGeneratorState</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211299"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- generator can be either changed or unchanged - we tried to generate moves but did not go deeper into the game tree</span><span>
</span><span id="line-87"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679211294"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211294"><span class="hs-identifier hs-var">move</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-88"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Int -&gt; Maybe GameState
</span><a href="Game.html#applyMove"><span class="hs-identifier hs-var">Game.applyMove</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211300"><span class="hs-identifier hs-var">gameState</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211294"><span class="hs-identifier hs-var">move</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-89"></span><span>                            </span><span class="annot"><span class="annottext">Maybe GameState
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Player
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211299"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- this should not happen because if move is generated by random move generator it should be a valid move</span><span>
</span><span id="line-90"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679211292"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211292"><span class="hs-identifier hs-var">nextState</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- there are possible further moves so we simulate further</span><span>
</span><span id="line-91"></span><span>                                </span><span class="hs-comment">--simulation nextState nextGen </span><span>
</span><span id="line-92"></span><span>                                </span><span class="annot"><span class="annottext">(GameState, Generator)
-&gt; (Maybe Player, Generator) -&gt; (Maybe Player, Generator)
</span><span class="hs-identifier hs-var">seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211292"><span class="hs-identifier hs-var">nextState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211296"><span class="hs-identifier hs-var">nextGen</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Maybe Player, Generator) -&gt; (Maybe Player, Generator))
-&gt; (Maybe Player, Generator) -&gt; (Maybe Player, Generator)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Generator -&gt; (Maybe Player, Generator)
</span><a href="AI.html#simulation"><span class="hs-identifier hs-var">simulation</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211292"><span class="hs-identifier hs-var">nextState</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211296"><span class="hs-identifier hs-var">nextGen</span></a></span><span> </span><span class="hs-comment">-- we use seq to make it strict</span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679211291"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211291"><span class="hs-identifier hs-var">winner</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Player -&gt; Maybe Player
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211291"><span class="hs-identifier hs-var">winner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211299"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- someone already wins in that state, there is no need for further simulation, we did not generate any moves so generator is unchanged</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- | Empty MCTS Tree Node.</span><span>
</span><span id="line-97"></span><span class="hs-comment">--   No playouts have originated from this node yet.</span><span>
</span><span id="line-98"></span><span class="annot"><a href="AI.html#emptyNode"><span class="hs-identifier hs-type">emptyNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Game.html#Player"><span class="hs-identifier hs-type">Player</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#MCTSNode"><span class="hs-identifier hs-type">MCTSNode</span></a></span><span>
</span><span id="line-99"></span><span id="emptyNode"><span class="annot"><span class="annottext">emptyNode :: Player -&gt; MCTSNode
</span><a href="AI.html#emptyNode"><span class="hs-identifier hs-var hs-var">emptyNode</span></a></span></span><span> </span><span id="local-6989586621679211289"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211289"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Player -&gt; Int -&gt; Int -&gt; Int -&gt; [(Int, MCTSNode)] -&gt; MCTSNode
</span><a href="AI.html#Node"><span class="hs-identifier hs-var">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211289"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- | For a given node and game result returns the node with updated wins/loses/draws counters.</span><span>
</span><span id="line-103"></span><span class="annot"><a href="AI.html#updatePointsBasingOnWinner"><span class="hs-identifier hs-type">updatePointsBasingOnWinner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AI.html#MCTSNode"><span class="hs-identifier hs-type">MCTSNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Game.html#Player"><span class="hs-identifier hs-type">Player</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#MCTSNode"><span class="hs-identifier hs-type">MCTSNode</span></a></span><span>
</span><span id="line-104"></span><span id="updatePointsBasingOnWinner"><span class="annot"><span class="annottext">updatePointsBasingOnWinner :: MCTSNode -&gt; Maybe Player -&gt; MCTSNode
</span><a href="AI.html#updatePointsBasingOnWinner"><span class="hs-identifier hs-var hs-var">updatePointsBasingOnWinner</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span id="local-6989586621679211287"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211287"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679211286"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211286"><span class="hs-identifier hs-var">won</span></a></span></span><span> </span><span id="local-6989586621679211285"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211285"><span class="hs-identifier hs-var">lost</span></a></span></span><span> </span><span id="local-6989586621679211284"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211284"><span class="hs-identifier hs-var">draws</span></a></span></span><span> </span><span id="local-6989586621679211283"><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211283"><span class="hs-identifier hs-var">children</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Player
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><span class="annottext">Player -&gt; Int -&gt; Int -&gt; Int -&gt; [(Int, MCTSNode)] -&gt; MCTSNode
</span><a href="AI.html#Node"><span class="hs-identifier hs-var">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211287"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211286"><span class="hs-identifier hs-var">won</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211285"><span class="hs-identifier hs-var">lost</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211284"><span class="hs-identifier hs-var">draws</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211283"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-106"></span><span class="annot"><a href="AI.html#updatePointsBasingOnWinner"><span class="hs-identifier hs-var">updatePointsBasingOnWinner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span id="local-6989586621679211281"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211281"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679211280"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211280"><span class="hs-identifier hs-var">won</span></a></span></span><span> </span><span id="local-6989586621679211279"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211279"><span class="hs-identifier hs-var">lost</span></a></span></span><span> </span><span id="local-6989586621679211278"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211278"><span class="hs-identifier hs-var">draws</span></a></span></span><span> </span><span id="local-6989586621679211277"><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211277"><span class="hs-identifier hs-var">children</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679211276"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211276"><span class="hs-identifier hs-var">winner</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679211271"><span class="annot"><span class="annottext">point :: Int
</span><a href="#local-6989586621679211271"><span class="hs-identifier hs-var hs-var">point</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211276"><span class="hs-identifier hs-var">winner</span></a></span><span> </span><span class="annot"><span class="annottext">Player -&gt; Player -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211281"><span class="hs-identifier hs-var">player</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- point = 1 or 0 depending on if player moving in this node has won or lost</span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">Player -&gt; Int -&gt; Int -&gt; Int -&gt; [(Int, MCTSNode)] -&gt; MCTSNode
</span><a href="AI.html#Node"><span class="hs-identifier hs-var">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211281"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211280"><span class="hs-identifier hs-var">won</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211271"><span class="hs-identifier hs-var">point</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211279"><span class="hs-identifier hs-var">lost</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211271"><span class="hs-identifier hs-var">point</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211278"><span class="hs-identifier hs-var">draws</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211277"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- | For a given random generator returns its next state</span><span>
</span><span id="line-112"></span><span class="annot"><a href="AI.html#nextGeneratorState"><span class="hs-identifier hs-type">nextGeneratorState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span>
</span><span id="line-113"></span><span id="nextGeneratorState"><span class="annot"><span class="annottext">nextGeneratorState :: Generator -&gt; Generator
</span><a href="AI.html#nextGeneratorState"><span class="hs-identifier hs-var hs-var">nextGeneratorState</span></a></span></span><span> </span><span id="local-6989586621679211269"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211269"><span class="hs-identifier hs-var">generator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word8, Generator) -&gt; Generator
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Generator -&gt; (Word8, Generator)
forall g. RandomGen g =&gt; g -&gt; (Word8, g)
</span><span class="hs-identifier hs-var">genWord8</span></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211269"><span class="hs-identifier hs-var">generator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- | For a given index and a list returns list where element with that index is moved to the head of the list.</span><span>
</span><span id="line-117"></span><span class="hs-comment">--   For index exceeding length of list produces error (Exception: Prelude.head: empty list).</span><span>
</span><span id="line-118"></span><span class="hs-comment">--   O(n), where n is length of list</span><span>
</span><span id="line-119"></span><span id="local-6989586621679211379"><span class="annot"><a href="AI.html#moveToStart"><span class="hs-identifier hs-type">moveToStart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679211379"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679211379"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-120"></span><span id="moveToStart"><span class="annot"><span class="annottext">moveToStart :: forall a. Int -&gt; [a] -&gt; [a]
</span><a href="AI.html#moveToStart"><span class="hs-identifier hs-var hs-var">moveToStart</span></a></span></span><span> </span><span id="local-6989586621679211266"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211266"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679211265"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211265"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="annottext">[a] -&gt; a
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211263"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211262"><span class="hs-identifier hs-var">hs</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211263"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679211262"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211262"><span class="hs-identifier hs-var">hs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211263"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211263"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [a] -&gt; ([a], [a])
forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211266"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211265"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- | For a given list selects one element randomly and puts it at the start.</span><span>
</span><span id="line-127"></span><span class="hs-comment">--   Does nothing for an empty list.</span><span>
</span><span id="line-128"></span><span class="hs-comment">--   O(n), where n is length of list</span><span>
</span><span id="line-129"></span><span class="annot"><a href="AI.html#randomShuffle"><span class="hs-identifier hs-type">randomShuffle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Game.html#Move"><span class="hs-identifier hs-type">Move</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Game.html#Move"><span class="hs-identifier hs-type">Move</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span id="randomShuffle"><span class="annot"><span class="annottext">randomShuffle :: [Int] -&gt; Generator -&gt; ([Int], Generator)
</span><a href="AI.html#randomShuffle"><span class="hs-identifier hs-var hs-var">randomShuffle</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679211258"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211258"><span class="hs-identifier hs-var">generator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator -&gt; Generator
</span><a href="AI.html#nextGeneratorState"><span class="hs-identifier hs-var">nextGeneratorState</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211258"><span class="hs-identifier hs-var">generator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span class="annot"><a href="AI.html#randomShuffle"><span class="hs-identifier hs-var">randomShuffle</span></a></span><span> </span><span id="local-6989586621679211257"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679211257"><span class="hs-identifier hs-var">moves</span></a></span></span><span> </span><span id="local-6989586621679211256"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211256"><span class="hs-identifier hs-var">generator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="AI.html#moveToStart"><span class="hs-identifier hs-var">moveToStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211255"><span class="hs-identifier hs-var">rand</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679211257"><span class="hs-identifier hs-var">moves</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211254"><span class="hs-identifier hs-var">nextGenerator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679211255"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211255"><span class="hs-identifier hs-var">rand</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211254"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211254"><span class="hs-identifier hs-var">nextGenerator</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Generator -&gt; (Int, Generator)
forall a g. (Random a, RandomGen g) =&gt; (a, a) -&gt; g -&gt; (a, g)
</span><span class="hs-identifier hs-var">randomR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679211257"><span class="hs-identifier hs-var">moves</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211256"><span class="hs-identifier hs-var">generator</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- | Find any (first) max element of a list, comparing by results of a given function applied to elements.</span><span>
</span><span id="line-138"></span><span class="hs-comment">--   O(n), where n is length of list</span><span>
</span><span id="line-139"></span><span id="local-6989586621679211372"><span id="local-6989586621679211373"><span class="annot"><a href="AI.html#maxBy"><span class="hs-identifier hs-type">maxBy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679211373"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679211372"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679211373"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679211372"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679211372"><span class="hs-identifier hs-type">a</span></a></span></span></span><span> </span><span>
</span><span id="line-140"></span><span id="maxBy"><span class="annot"><span class="annottext">maxBy :: forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; a
</span><a href="AI.html#maxBy"><span class="hs-identifier hs-var hs-var">maxBy</span></a></span></span><span> </span><span id="local-6989586621679211242"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679211242"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679211241"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211241"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span>
</span><span id="line-142"></span><span>        </span><span id="local-6989586621679211236"><span class="annot"><span class="annottext">pmaxim :: [a] -&gt; b -&gt; (a, b)
</span><a href="#local-6989586621679211236"><span class="hs-identifier hs-var hs-var">pmaxim</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; (a, b)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Empty list&quot;</span></span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><a href="#local-6989586621679211236"><span class="hs-identifier hs-var">pmaxim</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679211234"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211234"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621679211233"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211233"><span class="hs-identifier hs-var">xi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211234"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211233"><span class="hs-identifier hs-var">xi</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><a href="#local-6989586621679211236"><span class="hs-identifier hs-var">pmaxim</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679211232"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211232"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679211231"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211231"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679211230"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211230"><span class="hs-identifier hs-var">xi</span></a></span></span><span>
</span><span id="line-145"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679211242"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211232"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679211242"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211229"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211232"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211230"><span class="hs-identifier hs-var">xi</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211229"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211228"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679211229"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211229"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211228"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211228"><span class="hs-identifier hs-var">ti</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; b -&gt; (a, b)
</span><a href="#local-6989586621679211236"><span class="hs-identifier hs-var">pmaxim</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211231"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211230"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(a, Integer) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Integer -&gt; (a, Integer)
forall {b}. Num b =&gt; [a] -&gt; b -&gt; (a, b)
</span><a href="#local-6989586621679211236"><span class="hs-identifier hs-var">pmaxim</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211241"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">-- | Find index of any (first) max element of a list, comparing by result of a function applied to elements.</span><span>
</span><span id="line-152"></span><span class="hs-comment">--   O(n), where n is length of list</span><span>
</span><span id="line-153"></span><span id="local-6989586621679211361"><span id="local-6989586621679211362"><span class="annot"><a href="AI.html#indexMaxBy"><span class="hs-identifier hs-type">indexMaxBy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679211362"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679211361"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679211362"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679211361"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-154"></span><span id="indexMaxBy"><span class="annot"><span class="annottext">indexMaxBy :: forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; Int
</span><a href="AI.html#indexMaxBy"><span class="hs-identifier hs-var hs-var">indexMaxBy</span></a></span></span><span> </span><span id="local-6989586621679211221"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679211221"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679211220"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211220"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span>
</span><span id="line-156"></span><span>        </span><span id="local-6989586621679211215"><span class="annot"><span class="annottext">pmaxim :: [a] -&gt; b -&gt; (a, b)
</span><a href="#local-6989586621679211215"><span class="hs-identifier hs-var hs-var">pmaxim</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; (a, b)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Empty list&quot;</span></span><span>
</span><span id="line-157"></span><span>        </span><span class="annot"><a href="#local-6989586621679211215"><span class="hs-identifier hs-var">pmaxim</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679211214"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211214"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621679211213"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211213"><span class="hs-identifier hs-var">xi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211214"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211213"><span class="hs-identifier hs-var">xi</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><a href="#local-6989586621679211215"><span class="hs-identifier hs-var">pmaxim</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679211212"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211212"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679211211"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211211"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679211210"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211210"><span class="hs-identifier hs-var">xi</span></a></span></span><span>
</span><span id="line-159"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679211221"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211212"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679211221"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211209"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211212"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211210"><span class="hs-identifier hs-var">xi</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-160"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211209"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211208"><span class="hs-identifier hs-var">ti</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679211209"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211209"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211208"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211208"><span class="hs-identifier hs-var">ti</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; b -&gt; (a, b)
</span><a href="#local-6989586621679211215"><span class="hs-identifier hs-var">pmaxim</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211211"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679211210"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(a, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Int -&gt; (a, Int)
forall {b}. Num b =&gt; [a] -&gt; b -&gt; (a, b)
</span><a href="#local-6989586621679211215"><span class="hs-identifier hs-var">pmaxim</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211220"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">-- | Do Selection in a given node.</span><span>
</span><span id="line-166"></span><span class="hs-comment">--   Selected child is moved to the front of the children list.</span><span>
</span><span id="line-167"></span><span class="hs-comment">--   Selection is based on the UCB formula.</span><span>
</span><span id="line-168"></span><span class="hs-comment">--   O(n), where n is number of children</span><span>
</span><span id="line-169"></span><span class="annot"><a href="AI.html#selection"><span class="hs-identifier hs-type">selection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AI.html#MCTSNode"><span class="hs-identifier hs-type">MCTSNode</span></a></span><span> </span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-comment">-- ^ 'c' UCB balance parameter - originally 'c' = (sqrt 2) </span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#MCTSNode"><span class="hs-identifier hs-type">MCTSNode</span></a></span><span>
</span><span id="line-172"></span><span id="selection"><span class="annot"><span class="annottext">selection :: MCTSNode -&gt; Float -&gt; MCTSNode
</span><a href="AI.html#selection"><span class="hs-identifier hs-var hs-var">selection</span></a></span></span><span> </span><span id="local-6989586621679211204"><span class="annot"><span class="annottext">node :: MCTSNode
</span><a href="#local-6989586621679211204"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span id="local-6989586621679211203"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211203"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679211202"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211202"><span class="hs-identifier hs-var">won</span></a></span></span><span> </span><span id="local-6989586621679211201"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211201"><span class="hs-identifier hs-var">lost</span></a></span></span><span> </span><span id="local-6989586621679211200"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211200"><span class="hs-identifier hs-var">draws</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211204"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-173"></span><span class="annot"><a href="AI.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span id="local-6989586621679211199"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211199"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679211198"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211198"><span class="hs-identifier hs-var">won</span></a></span></span><span> </span><span id="local-6989586621679211197"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211197"><span class="hs-identifier hs-var">lost</span></a></span></span><span> </span><span id="local-6989586621679211196"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211196"><span class="hs-identifier hs-var">draws</span></a></span></span><span> </span><span id="local-6989586621679211195"><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211195"><span class="hs-identifier hs-var">children</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679211194"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211194"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">Player -&gt; Int -&gt; Int -&gt; Int -&gt; [(Int, MCTSNode)] -&gt; MCTSNode
</span><a href="AI.html#Node"><span class="hs-identifier hs-var">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211199"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211198"><span class="hs-identifier hs-var">won</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211197"><span class="hs-identifier hs-var">lost</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211196"><span class="hs-identifier hs-var">draws</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [(Int, MCTSNode)] -&gt; [(Int, MCTSNode)]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="AI.html#moveToStart"><span class="hs-identifier hs-var">moveToStart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211193"><span class="hs-identifier hs-var">selectedIndex</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211195"><span class="hs-identifier hs-var">children</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-176"></span><span>        </span><span id="local-6989586621679211186"><span class="annot"><span class="annottext">fathersSum :: Float
</span><a href="#local-6989586621679211186"><span class="hs-identifier hs-var hs-var">fathersSum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Float
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211198"><span class="hs-identifier hs-var">won</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211197"><span class="hs-identifier hs-var">lost</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211196"><span class="hs-identifier hs-var">draws</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-177"></span><span>        </span><span id="local-6989586621679211169"><span class="annot"><span class="annottext">ucb :: Float -&gt; MCTSNode -&gt; Float
</span><a href="#local-6989586621679211169"><span class="hs-identifier hs-var hs-var">ucb</span></a></span></span><span> </span><span id="local-6989586621679211168"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211168"><span class="hs-identifier hs-var">bigN</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">9999999997</span></span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><a href="#local-6989586621679211169"><span class="hs-identifier hs-var">ucb</span></a></span><span> </span><span id="local-6989586621679211167"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211167"><span class="hs-identifier hs-var">bigN</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679211166"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211166"><span class="hs-identifier hs-var">wi</span></a></span></span><span> </span><span id="local-6989586621679211165"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211165"><span class="hs-identifier hs-var">li</span></a></span></span><span> </span><span id="local-6989586621679211164"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211164"><span class="hs-identifier hs-var">di</span></a></span></span><span> </span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-179"></span><span>            </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211163"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211161"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211194"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float -&gt; Float
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float -&gt; Float
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211167"><span class="hs-identifier hs-var">bigN</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211161"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-181"></span><span>                </span><span id="local-6989586621679211163"><span class="annot"><span class="annottext">w :: Float
</span><a href="#local-6989586621679211163"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Float
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211166"><span class="hs-identifier hs-var">wi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-182"></span><span>                </span><span id="local-6989586621679211153"><span class="annot"><span class="annottext">l :: Float
</span><a href="#local-6989586621679211153"><span class="hs-identifier hs-var hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Float
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211165"><span class="hs-identifier hs-var">li</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-183"></span><span>                </span><span id="local-6989586621679211150"><span class="annot"><span class="annottext">d :: Float
</span><a href="#local-6989586621679211150"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Float
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211164"><span class="hs-identifier hs-var">di</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-184"></span><span>                </span><span id="local-6989586621679211161"><span class="annot"><span class="annottext">n :: Float
</span><a href="#local-6989586621679211161"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211163"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211153"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211150"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span id="local-6989586621679211193"><span class="annot"><span class="annottext">selectedIndex :: Int
</span><a href="#local-6989586621679211193"><span class="hs-identifier hs-var hs-var">selectedIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, MCTSNode) -&gt; Float) -&gt; [(Int, MCTSNode)] -&gt; Int
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; Int
</span><a href="AI.html#indexMaxBy"><span class="hs-identifier hs-var">indexMaxBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211145"><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211145"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Float -&gt; MCTSNode -&gt; Float
</span><a href="#local-6989586621679211169"><span class="hs-identifier hs-var">ucb</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211186"><span class="hs-identifier hs-var">fathersSum</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211145"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211195"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- | Do Selection, Expansion, Simulation, Backpropagation once</span><span>
</span><span id="line-189"></span><span class="hs-comment">--   O(2 * (2(m-k)(n-k) + m(n-k) + n(m-k)) * k * log(m*n) * g), where (m,n,k) is board setting, and g is number of played moves until the playout ends</span><span>
</span><span id="line-190"></span><span class="annot"><a href="AI.html#iterateOnce"><span class="hs-identifier hs-type">iterateOnce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Game.html#GameState"><span class="hs-identifier hs-type">GameState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#MCTSNode"><span class="hs-identifier hs-type">MCTSNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AI.html#MCTSNode"><span class="hs-identifier hs-type">MCTSNode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Game.html#Player"><span class="hs-identifier hs-type">Player</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- Leaf node</span><span>
</span><span id="line-192"></span><span id="iterateOnce"><span class="annot"><span class="annottext">iterateOnce :: GameState
-&gt; MCTSNode
-&gt; Generator
-&gt; Float
-&gt; (MCTSNode, Maybe Player, Generator)
</span><a href="AI.html#iterateOnce"><span class="hs-identifier hs-var hs-var">iterateOnce</span></a></span></span><span> </span><span id="local-6989586621679211143"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211143"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span id="local-6989586621679211142"><span class="annot"><span class="annottext">node :: MCTSNode
</span><a href="#local-6989586621679211142"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span id="local-6989586621679211141"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211141"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679211140"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211140"><span class="hs-identifier hs-var">won</span></a></span></span><span> </span><span id="local-6989586621679211139"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211139"><span class="hs-identifier hs-var">lost</span></a></span></span><span> </span><span id="local-6989586621679211138"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211138"><span class="hs-identifier hs-var">draws</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679211137"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211137"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span id="local-6989586621679211136"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211136"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Maybe Player
</span><a href="Game.html#whoWins"><span class="hs-identifier hs-var">Game.whoWins</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211143"><span class="hs-identifier hs-var">gs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679211135"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211135"><span class="hs-identifier hs-var">winner</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-195"></span><span>            </span><span class="hs-comment">-- game is already won in this node - we only increase won/lost, no Expansion/Simulation</span><span>
</span><span id="line-196"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MCTSNode -&gt; Maybe Player -&gt; MCTSNode
</span><a href="AI.html#updatePointsBasingOnWinner"><span class="hs-identifier hs-var">updatePointsBasingOnWinner</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211142"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Player -&gt; Maybe Player
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211135"><span class="hs-identifier hs-var">winner</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Player -&gt; Maybe Player
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211135"><span class="hs-identifier hs-var">winner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator -&gt; Generator
</span><a href="AI.html#nextGeneratorState"><span class="hs-identifier hs-var">nextGeneratorState</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211137"><span class="hs-identifier hs-var">gen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><span class="annottext">Maybe Player
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-198"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Generator -&gt; ([Int], Generator)
</span><a href="AI.html#randomShuffle"><span class="hs-identifier hs-var">randomShuffle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GameState -&gt; [Int]
</span><a href="Game.html#availableMoves"><span class="hs-identifier hs-var">Game.availableMoves</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211143"><span class="hs-identifier hs-var">gs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211137"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-199"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211134"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211134"><span class="hs-identifier hs-var">gen2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-200"></span><span>                    </span><span class="hs-comment">-- there are no possible moves from this node, so its a draw, we only increase draws, no Expansion/Simulation</span><span>
</span><span id="line-201"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MCTSNode -&gt; Maybe Player -&gt; MCTSNode
</span><a href="AI.html#updatePointsBasingOnWinner"><span class="hs-identifier hs-var">updatePointsBasingOnWinner</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211142"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Player
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Player
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator -&gt; Generator
</span><a href="AI.html#nextGeneratorState"><span class="hs-identifier hs-var">nextGeneratorState</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211134"><span class="hs-identifier hs-var">gen2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679211133"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211133"><span class="hs-identifier hs-var">luckyChildMove</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679211132"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679211132"><span class="hs-identifier hs-var">otherChildrenMoves</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211131"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211131"><span class="hs-identifier hs-var">gen2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-203"></span><span>                    </span><span class="hs-comment">-- there is at least one possible move from that node - so we Expand</span><span>
</span><span id="line-204"></span><span>                    </span><span class="hs-comment">-- lucky child is a child, that we will be simulating from - its chosen randomly, as first element of randomShuffle</span><span>
</span><span id="line-205"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Int -&gt; Maybe GameState
</span><a href="Game.html#applyMove"><span class="hs-identifier hs-var">Game.applyMove</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211143"><span class="hs-identifier hs-var">gs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211133"><span class="hs-identifier hs-var">luckyChildMove</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-206"></span><span>                        </span><span class="annot"><span class="annottext">Maybe GameState
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- this should not happen, because the move should be valid - we got it from the Game.availableMoves function</span><span>
</span><span id="line-207"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Player -&gt; Int -&gt; Int -&gt; Int -&gt; [(Int, MCTSNode)] -&gt; MCTSNode
</span><a href="AI.html#Node"><span class="hs-identifier hs-var">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211141"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211140"><span class="hs-identifier hs-var">won</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211139"><span class="hs-identifier hs-var">lost</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211138"><span class="hs-identifier hs-var">draws</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Player
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211131"><span class="hs-identifier hs-var">gen2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679211130"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211130"><span class="hs-identifier hs-var">luckyChildState</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-209"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span>
</span><span id="line-210"></span><span>                                    </span><span class="hs-comment">-- we do the Simulation:</span><span>
</span><span id="line-211"></span><span>                                    </span><span class="hs-special">(</span><span id="local-6989586621679211129"><span class="annot"><span class="annottext">Maybe Player
</span><a href="#local-6989586621679211129"><span class="hs-identifier hs-var">simulationWinner</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211128"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211128"><span class="hs-identifier hs-var">gen3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Generator -&gt; (Maybe Player, Generator)
</span><a href="AI.html#simulation"><span class="hs-identifier hs-var">simulation</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211130"><span class="hs-identifier hs-var">luckyChildState</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211131"><span class="hs-identifier hs-var">gen2</span></a></span><span>
</span><span id="line-212"></span><span>                                    </span><span class="hs-comment">-- we build children nodes:</span><span>
</span><span id="line-213"></span><span>                                    </span><span id="local-6989586621679211127"><span class="annot"><span class="annottext">luckyChildNode :: MCTSNode
</span><a href="#local-6989586621679211127"><span class="hs-identifier hs-var hs-var">luckyChildNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCTSNode -&gt; Maybe Player -&gt; MCTSNode
</span><a href="AI.html#updatePointsBasingOnWinner"><span class="hs-identifier hs-var">updatePointsBasingOnWinner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Player -&gt; MCTSNode
</span><a href="AI.html#emptyNode"><span class="hs-identifier hs-var">emptyNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Player -&gt; Player
</span><a href="Game.html#oponent"><span class="hs-identifier hs-var">Game.oponent</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211141"><span class="hs-identifier hs-var">player</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Player
</span><a href="#local-6989586621679211129"><span class="hs-identifier hs-var">simulationWinner</span></a></span><span>
</span><span id="line-214"></span><span>                                    </span><span id="local-6989586621679211125"><span class="annot"><span class="annottext">luckyChildEdge :: (Int, MCTSNode)
</span><a href="#local-6989586621679211125"><span class="hs-identifier hs-var hs-var">luckyChildEdge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211133"><span class="hs-identifier hs-var">luckyChildMove</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211127"><span class="hs-identifier hs-var">luckyChildNode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>                                    </span><span id="local-6989586621679211124"><span class="annot"><span class="annottext">otherChildrenEdges :: [(Int, MCTSNode)]
</span><a href="#local-6989586621679211124"><span class="hs-identifier hs-var hs-var">otherChildrenEdges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Int, MCTSNode)) -&gt; [Int] -&gt; [(Int, MCTSNode)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679211123"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211123"><span class="hs-identifier hs-var">move</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211123"><span class="hs-identifier hs-var">move</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Player -&gt; MCTSNode
</span><a href="AI.html#emptyNode"><span class="hs-identifier hs-var">emptyNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Player -&gt; Player
</span><a href="Game.html#oponent"><span class="hs-identifier hs-var">Game.oponent</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211141"><span class="hs-identifier hs-var">player</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679211132"><span class="hs-identifier hs-var">otherChildrenMoves</span></a></span><span>
</span><span id="line-216"></span><span>                                    </span><span class="hs-comment">-- the lucky one is the first one on the list - positions on the list doesn't matter</span><span>
</span><span id="line-217"></span><span>                                    </span><span id="local-6989586621679211122"><span class="annot"><span class="annottext">allChildren :: [(Int, MCTSNode)]
</span><a href="#local-6989586621679211122"><span class="hs-identifier hs-var hs-var">allChildren</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, MCTSNode)
</span><a href="#local-6989586621679211125"><span class="hs-identifier hs-var">luckyChildEdge</span></a></span><span class="annot"><span class="annottext">(Int, MCTSNode) -&gt; [(Int, MCTSNode)] -&gt; [(Int, MCTSNode)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211124"><span class="hs-identifier hs-var">otherChildrenEdges</span></a></span><span>
</span><span id="line-218"></span><span>                                    </span><span class="hs-comment">-- we append children list to the node</span><span>
</span><span id="line-219"></span><span>                                    </span><span id="local-6989586621679211121"><span class="annot"><span class="annottext">notUpdatedNode :: MCTSNode
</span><a href="#local-6989586621679211121"><span class="hs-identifier hs-var hs-var">notUpdatedNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Player -&gt; Int -&gt; Int -&gt; Int -&gt; [(Int, MCTSNode)] -&gt; MCTSNode
</span><a href="AI.html#Node"><span class="hs-identifier hs-var">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211141"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211140"><span class="hs-identifier hs-var">won</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211139"><span class="hs-identifier hs-var">lost</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211138"><span class="hs-identifier hs-var">draws</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211122"><span class="hs-identifier hs-var">allChildren</span></a></span><span>
</span><span id="line-220"></span><span>                                    </span><span class="hs-comment">-- we update node win informations basing on simulation results</span><span>
</span><span id="line-221"></span><span>                                    </span><span id="local-6989586621679211120"><span class="annot"><span class="annottext">backpropagatedNode :: MCTSNode
</span><a href="#local-6989586621679211120"><span class="hs-identifier hs-var hs-var">backpropagatedNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCTSNode -&gt; Maybe Player -&gt; MCTSNode
</span><a href="AI.html#updatePointsBasingOnWinner"><span class="hs-identifier hs-var">updatePointsBasingOnWinner</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211121"><span class="hs-identifier hs-var">notUpdatedNode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Player
</span><a href="#local-6989586621679211129"><span class="hs-identifier hs-var">simulationWinner</span></a></span><span>
</span><span id="line-222"></span><span>                                    </span><span class="hs-comment">-- we do the Selection</span><span>
</span><span id="line-223"></span><span>                                    </span><span id="local-6989586621679211119"><span class="annot"><span class="annottext">updatedNode :: MCTSNode
</span><a href="#local-6989586621679211119"><span class="hs-identifier hs-var hs-var">updatedNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCTSNode -&gt; Float -&gt; MCTSNode
</span><a href="AI.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211120"><span class="hs-identifier hs-var">backpropagatedNode</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211136"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-224"></span><span>                                </span><span class="hs-keyword">in</span><span>
</span><span id="line-225"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211119"><span class="hs-identifier hs-var">updatedNode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Player
</span><a href="#local-6989586621679211129"><span class="hs-identifier hs-var">simulationWinner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211128"><span class="hs-identifier hs-var">gen3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- Internal node</span><span>
</span><span id="line-227"></span><span class="annot"><a href="AI.html#iterateOnce"><span class="hs-identifier hs-var">iterateOnce</span></a></span><span> </span><span id="local-6989586621679211118"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211118"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span id="local-6989586621679211117"><span class="annot"><span class="annottext">node :: MCTSNode
</span><a href="#local-6989586621679211117"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span id="local-6989586621679211116"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211116"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679211115"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211115"><span class="hs-identifier hs-var">won</span></a></span></span><span> </span><span id="local-6989586621679211114"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211114"><span class="hs-identifier hs-var">lost</span></a></span></span><span> </span><span id="local-6989586621679211113"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211113"><span class="hs-identifier hs-var">draws</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679211112"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211112"><span class="hs-identifier hs-var">selectedChildMove</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211111"><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211111"><span class="hs-identifier hs-var">selectedChildNode</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679211110"><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211110"><span class="hs-identifier hs-var">otherChildrenEdges</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679211109"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211109"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span id="local-6989586621679211108"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211108"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Int -&gt; Maybe GameState
</span><a href="Game.html#applyMove"><span class="hs-identifier hs-var">Game.applyMove</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211118"><span class="hs-identifier hs-var">gs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211112"><span class="hs-identifier hs-var">selectedChildMove</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-229"></span><span>        </span><span class="annot"><span class="annottext">Maybe GameState
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- shouldnt happen, there is a child that was created with that move, so that move should be corect</span><span>
</span><span id="line-230"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211117"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Player
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211109"><span class="hs-identifier hs-var">gen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679211107"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211107"><span class="hs-identifier hs-var">selectedChildGameState</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211106"><span class="hs-identifier hs-var">resultingNode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Player
</span><a href="#local-6989586621679211105"><span class="hs-identifier hs-var">simulationWinner</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211104"><span class="hs-identifier hs-var">nextGen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-234"></span><span>                </span><span class="hs-comment">-- we run iteration recursively for the Selected child</span><span>
</span><span id="line-235"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679211103"><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211103"><span class="hs-identifier hs-var">updatedSelectedChildNode</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211105"><span class="annot"><span class="annottext">Maybe Player
</span><a href="#local-6989586621679211105"><span class="hs-identifier hs-var">simulationWinner</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211104"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211104"><span class="hs-identifier hs-var">nextGen</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GameState
-&gt; MCTSNode
-&gt; Generator
-&gt; Float
-&gt; (MCTSNode, Maybe Player, Generator)
</span><a href="AI.html#iterateOnce"><span class="hs-identifier hs-var">iterateOnce</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211107"><span class="hs-identifier hs-var">selectedChildGameState</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211111"><span class="hs-identifier hs-var">selectedChildNode</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211109"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211108"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-236"></span><span>                </span><span class="hs-comment">-- we update the child in our node</span><span>
</span><span id="line-237"></span><span>                </span><span id="local-6989586621679211102"><span class="annot"><span class="annottext">nodeWithUpdatedChild :: MCTSNode
</span><a href="#local-6989586621679211102"><span class="hs-identifier hs-var hs-var">nodeWithUpdatedChild</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Player -&gt; Int -&gt; Int -&gt; Int -&gt; [(Int, MCTSNode)] -&gt; MCTSNode
</span><a href="AI.html#Node"><span class="hs-identifier hs-var">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211116"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211115"><span class="hs-identifier hs-var">won</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211114"><span class="hs-identifier hs-var">lost</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211113"><span class="hs-identifier hs-var">draws</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211112"><span class="hs-identifier hs-var">selectedChildMove</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211103"><span class="hs-identifier hs-var">updatedSelectedChildNode</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Int, MCTSNode) -&gt; [(Int, MCTSNode)] -&gt; [(Int, MCTSNode)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211110"><span class="hs-identifier hs-var">otherChildrenEdges</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>                </span><span class="hs-comment">-- we update won/lost/draws information in out node (= Backpropagation)</span><span>
</span><span id="line-239"></span><span>                </span><span id="local-6989586621679211101"><span class="annot"><span class="annottext">nodeWithUpdatedWeights :: MCTSNode
</span><a href="#local-6989586621679211101"><span class="hs-identifier hs-var hs-var">nodeWithUpdatedWeights</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCTSNode -&gt; Maybe Player -&gt; MCTSNode
</span><a href="AI.html#updatePointsBasingOnWinner"><span class="hs-identifier hs-var">updatePointsBasingOnWinner</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211102"><span class="hs-identifier hs-var">nodeWithUpdatedChild</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Player
</span><a href="#local-6989586621679211105"><span class="hs-identifier hs-var">simulationWinner</span></a></span><span>
</span><span id="line-240"></span><span>                </span><span class="hs-comment">-- we do the Selection</span><span>
</span><span id="line-241"></span><span>                </span><span id="local-6989586621679211106"><span class="annot"><span class="annottext">resultingNode :: MCTSNode
</span><a href="#local-6989586621679211106"><span class="hs-identifier hs-var hs-var">resultingNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCTSNode -&gt; Float -&gt; MCTSNode
</span><a href="AI.html#selection"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211101"><span class="hs-identifier hs-var">nodeWithUpdatedWeights</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211108"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-242"></span><span>                </span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- | Select best move based on the MCTS Tree</span><span>
</span><span id="line-245"></span><span class="annot"><a href="AI.html#bestMoveFromTree"><span class="hs-identifier hs-type">bestMoveFromTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AI.html#MCTSNode"><span class="hs-identifier hs-type">MCTSNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Game.html#Move"><span class="hs-identifier hs-type">Move</span></a></span><span>
</span><span id="line-246"></span><span id="bestMoveFromTree"><span class="annot"><span class="annottext">bestMoveFromTree :: MCTSNode -&gt; Maybe Int
</span><a href="AI.html#bestMoveFromTree"><span class="hs-identifier hs-var hs-var">bestMoveFromTree</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-247"></span><span class="annot"><a href="AI.html#bestMoveFromTree"><span class="hs-identifier hs-var">bestMoveFromTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679211099"><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211099"><span class="hs-identifier hs-var">children</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, MCTSNode) -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, MCTSNode) -&gt; Int) -&gt; [(Int, MCTSNode)] -&gt; (Int, MCTSNode)
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; a
</span><a href="AI.html#maxBy"><span class="hs-identifier hs-var">maxBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679211098"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211098"><span class="hs-identifier hs-var">cm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211097"><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211097"><span class="hs-identifier hs-var">cn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MCTSNode -&gt; Int
</span><a href="#local-6989586621679211096"><span class="hs-identifier hs-var">numberOfSimulations</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211097"><span class="hs-identifier hs-var">cn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><a href="#local-6989586621679211099"><span class="hs-identifier hs-var">children</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679211096"><span class="annot"><span class="annottext">numberOfSimulations :: MCTSNode -&gt; Int
</span><a href="#local-6989586621679211096"><span class="hs-identifier hs-var hs-var">numberOfSimulations</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AI.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679211093"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211093"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679211092"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211092"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679211091"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211091"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">[(Int, MCTSNode)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211093"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211092"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211091"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="hs-comment">-- | Applies given function 'f' n times to a given starting value</span><span>
</span><span id="line-252"></span><span class="hs-comment">--   Tail recursive and strict</span><span>
</span><span id="line-253"></span><span id="local-6989586621679211351"><span class="annot"><a href="AI.html#iterateF"><span class="hs-identifier hs-type">iterateF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679211351"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679211351"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- ^ n</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679211351"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-comment">-- ^ starting value 'a'</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679211351"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-comment">-- ^ result = f(f(f(f(...(f(a))))))</span><span>
</span><span id="line-257"></span><span id="iterateF"><span class="annot"><span class="annottext">iterateF :: forall a. (a -&gt; a) -&gt; Int -&gt; a -&gt; a
</span><a href="AI.html#iterateF"><span class="hs-identifier hs-var hs-var">iterateF</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621679211085"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211085"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211085"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-258"></span><span class="annot"><a href="AI.html#iterateF"><span class="hs-identifier hs-var">iterateF</span></a></span><span> </span><span id="local-6989586621679211084"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679211084"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679211083"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211083"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679211082"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211082"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">seq</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211081"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; Int -&gt; a -&gt; a
forall a. (a -&gt; a) -&gt; Int -&gt; a -&gt; a
</span><a href="AI.html#iterateF"><span class="hs-identifier hs-var">iterateF</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679211084"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211083"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211081"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621679211081"><span class="annot"><span class="annottext">next :: a
</span><a href="#local-6989586621679211081"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679211084"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211082"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | First element of the list satisfying given predicate. If there is no one satisfying then none</span><span>
</span><span id="line-263"></span><span id="local-6989586621679211349"><span class="annot"><a href="AI.html#findFirst"><span class="hs-identifier hs-type">findFirst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679211349"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679211349"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679211349"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-264"></span><span id="findFirst"><span class="annot"><span class="annottext">findFirst :: forall a. (a -&gt; Bool) -&gt; [a] -&gt; Maybe a
</span><a href="AI.html#findFirst"><span class="hs-identifier hs-var hs-var">findFirst</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-265"></span><span class="annot"><a href="AI.html#findFirst"><span class="hs-identifier hs-var">findFirst</span></a></span><span> </span><span id="local-6989586621679211079"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679211079"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679211078"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211078"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679211077"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211077"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679211079"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211078"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-267"></span><span>        </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679211078"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-269"></span><span>        </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; [a] -&gt; Maybe a
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Maybe a
</span><a href="AI.html#findFirst"><span class="hs-identifier hs-var">findFirst</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679211079"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679211077"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-comment">-- | Whether a move from a given gamestate is winning for a given player.</span><span>
</span><span id="line-273"></span><span class="hs-comment">--   If a move is incorrect does not throw any error and just returns False.</span><span>
</span><span id="line-274"></span><span class="annot"><a href="AI.html#checkMoveWinning"><span class="hs-identifier hs-type">checkMoveWinning</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Game.html#GameState"><span class="hs-identifier hs-type">GameState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Game.html#Player"><span class="hs-identifier hs-type">Player</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Game.html#Move"><span class="hs-identifier hs-type">Move</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-275"></span><span id="checkMoveWinning"><span class="annot"><span class="annottext">checkMoveWinning :: GameState -&gt; Player -&gt; Int -&gt; Bool
</span><a href="AI.html#checkMoveWinning"><span class="hs-identifier hs-var hs-var">checkMoveWinning</span></a></span></span><span> </span><span id="local-6989586621679211075"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211075"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span id="local-6989586621679211074"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211074"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679211073"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211073"><span class="hs-identifier hs-var">move</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Int -&gt; Maybe GameState
</span><a href="Game.html#applyMove"><span class="hs-identifier hs-var">Game.applyMove</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211075"><span class="hs-identifier hs-var">gs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211073"><span class="hs-identifier hs-var">move</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">Maybe GameState
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679211072"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211072"><span class="hs-identifier hs-var">nextState</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Player -&gt; Bool
</span><a href="Game.html#doesPlayerWin"><span class="hs-identifier hs-var">Game.doesPlayerWin</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211072"><span class="hs-identifier hs-var">nextState</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211074"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">-- | Returns Just move if there is a winning move from a given gamestate for a given player, Nothing otherwise.</span><span>
</span><span id="line-282"></span><span class="annot"><a href="AI.html#getWinningMove"><span class="hs-identifier hs-type">getWinningMove</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Game.html#GameState"><span class="hs-identifier hs-type">GameState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Game.html#Player"><span class="hs-identifier hs-type">Player</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Game.html#Move"><span class="hs-identifier hs-type">Move</span></a></span><span>
</span><span id="line-283"></span><span id="getWinningMove"><span class="annot"><span class="annottext">getWinningMove :: GameState -&gt; Player -&gt; Maybe Int
</span><a href="AI.html#getWinningMove"><span class="hs-identifier hs-var hs-var">getWinningMove</span></a></span></span><span> </span><span id="local-6989586621679211069"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211069"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span id="local-6989586621679211068"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211068"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; [Int] -&gt; Maybe Int
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Maybe a
</span><a href="AI.html#findFirst"><span class="hs-identifier hs-var">findFirst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GameState -&gt; Player -&gt; Int -&gt; Bool
</span><a href="AI.html#checkMoveWinning"><span class="hs-identifier hs-var">checkMoveWinning</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211069"><span class="hs-identifier hs-var">gs</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211068"><span class="hs-identifier hs-var">player</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GameState -&gt; [Int]
</span><a href="Game.html#availableMoves"><span class="hs-identifier hs-var">Game.availableMoves</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211069"><span class="hs-identifier hs-var">gs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">-- | Returns next move generated by the MCTS algorithm.</span><span>
</span><span id="line-287"></span><span class="annot"><a href="AI.html#getMCTSMove"><span class="hs-identifier hs-type">getMCTSMove</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span>
</span><span id="line-288"></span><span>     </span><span class="annot"><a href="Game.html#GameState"><span class="hs-identifier hs-type">GameState</span></a></span><span> </span><span class="hs-comment">-- ^ Game state to which AI player should respond</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#Hiperparameters"><span class="hs-identifier hs-type">Hiperparameters</span></a></span><span> </span><span class="hs-comment">-- ^ MCTS algorithm hiperparameters</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="hs-comment">-- ^ Random number generator state</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Game.html#Move"><span class="hs-identifier hs-type">Move</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ pair of (Maybe MCTS generated move, next generator state):</span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-comment">-- Maybe MCTS generated move - If there is a move possible then Just Move, if there is no move possible Nothing </span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-comment">-- next generator state- State of the random number generator after calculating the move.</span><span>
</span><span id="line-294"></span><span id="getMCTSMove"><span class="annot"><span class="annottext">getMCTSMove :: GameState -&gt; Hiperparameters -&gt; Generator -&gt; (Maybe Int, Generator)
</span><a href="AI.html#getMCTSMove"><span class="hs-identifier hs-var hs-var">getMCTSMove</span></a></span></span><span> </span><span id="local-6989586621679211066"><span class="annot"><span class="annottext">gameState :: GameState
</span><a href="#local-6989586621679211066"><span class="hs-identifier hs-var">gameState</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Game.html#GameState"><span class="hs-identifier hs-type">GameState</span></a></span><span> </span><span class="annot"><span class="annottext">BoardSetting
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BoardState
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679211064"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211064"><span class="hs-identifier hs-var">player</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AI.html#MCTS"><span class="hs-identifier hs-type">MCTS</span></a></span><span> </span><span id="local-6989586621679211063"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211063"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679211062"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211062"><span class="hs-identifier hs-var">niters</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679211061"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211061"><span class="hs-identifier hs-var">generator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MCTSNode -&gt; Maybe Int
</span><a href="AI.html#bestMoveFromTree"><span class="hs-identifier hs-var">bestMoveFromTree</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211060"><span class="hs-identifier hs-var">finalTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211059"><span class="hs-identifier hs-var">finalGen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679211060"><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211060"><span class="hs-identifier hs-var">finalTree</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Player
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211059"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211059"><span class="hs-identifier hs-var">finalGen</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((MCTSNode, Maybe Player, Generator)
 -&gt; (MCTSNode, Maybe Player, Generator))
-&gt; Int
-&gt; (MCTSNode, Maybe Player, Generator)
-&gt; (MCTSNode, Maybe Player, Generator)
forall a. (a -&gt; a) -&gt; Int -&gt; a -&gt; a
</span><a href="AI.html#iterateF"><span class="hs-identifier hs-var">iterateF</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679211058"><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211058"><span class="hs-identifier hs-var">tree</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Player
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679211057"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211057"><span class="hs-identifier hs-var">gen</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GameState
-&gt; MCTSNode
-&gt; Generator
-&gt; Float
-&gt; (MCTSNode, Maybe Player, Generator)
</span><a href="AI.html#iterateOnce"><span class="hs-identifier hs-var">iterateOnce</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211066"><span class="hs-identifier hs-var">gameState</span></a></span><span> </span><span class="annot"><span class="annottext">MCTSNode
</span><a href="#local-6989586621679211058"><span class="hs-identifier hs-var">tree</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211057"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679211063"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211062"><span class="hs-identifier hs-var">niters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Player -&gt; MCTSNode
</span><a href="AI.html#emptyNode"><span class="hs-identifier hs-var">emptyNode</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211064"><span class="hs-identifier hs-var">player</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Player
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211061"><span class="hs-identifier hs-var">generator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-comment">-- | Returns next move of the AI player.</span><span>
</span><span id="line-301"></span><span class="annot"><a href="AI.html#getNextMove"><span class="hs-identifier hs-type">getNextMove</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span>
</span><span id="line-302"></span><span>     </span><span class="annot"><a href="Game.html#GameState"><span class="hs-identifier hs-type">GameState</span></a></span><span> </span><span class="hs-comment">-- ^ Game state to which AI player should respond</span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#Hiperparameters"><span class="hs-identifier hs-type">Hiperparameters</span></a></span><span> </span><span class="hs-comment">-- ^ MCTS algorithm hiperparameters</span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="hs-comment">-- ^ Random number generator state</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Game.html#Move"><span class="hs-identifier hs-type">Move</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="AI.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ (If there is a move possible then Just Move, if there is no move possible Nothing, State of the random number generator after calculating the move.)</span><span>
</span><span id="line-306"></span><span id="getNextMove"><span class="annot"><span class="annottext">getNextMove :: GameState -&gt; Hiperparameters -&gt; Generator -&gt; (Maybe Int, Generator)
</span><a href="AI.html#getNextMove"><span class="hs-identifier hs-var hs-var">getNextMove</span></a></span></span><span> </span><span id="local-6989586621679211056"><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211056"><span class="hs-identifier hs-var">gameState</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hiperparameters
</span><a href="AI.html#Random"><span class="hs-identifier hs-var">Random</span></a></span><span> </span><span id="local-6989586621679211055"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211055"><span class="hs-identifier hs-var">generator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><span class="annottext">GameState -&gt; Generator -&gt; (Maybe Int, Generator)
</span><a href="AI.html#getRandomMove"><span class="hs-identifier hs-var">getRandomMove</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211056"><span class="hs-identifier hs-var">gameState</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211055"><span class="hs-identifier hs-var">generator</span></a></span><span>
</span><span id="line-308"></span><span class="annot"><a href="AI.html#getNextMove"><span class="hs-identifier hs-var">getNextMove</span></a></span><span> </span><span id="local-6989586621679211054"><span class="annot"><span class="annottext">gameState :: GameState
</span><a href="#local-6989586621679211054"><span class="hs-identifier hs-var">gameState</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Game.html#GameState"><span class="hs-identifier hs-type">GameState</span></a></span><span> </span><span class="annot"><span class="annottext">BoardSetting
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BoardState
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679211053"><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211053"><span class="hs-identifier hs-var">player</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679211052"><span class="annot"><span class="annottext">Hiperparameters
</span><a href="#local-6989586621679211052"><span class="hs-identifier hs-var">hyperparameters</span></a></span></span><span> </span><span id="local-6989586621679211051"><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211051"><span class="hs-identifier hs-var">generator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Player -&gt; Maybe Int
</span><a href="AI.html#getWinningMove"><span class="hs-identifier hs-var">getWinningMove</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211054"><span class="hs-identifier hs-var">gameState</span></a></span><span> </span><span class="annot"><span class="annottext">Player
</span><a href="#local-6989586621679211053"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679211050"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211050"><span class="hs-identifier hs-var">move</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679211050"><span class="hs-identifier hs-var">move</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator -&gt; Generator
</span><a href="AI.html#nextGeneratorState"><span class="hs-identifier hs-var">nextGeneratorState</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211051"><span class="hs-identifier hs-var">generator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GameState -&gt; Hiperparameters -&gt; Generator -&gt; (Maybe Int, Generator)
</span><a href="AI.html#getMCTSMove"><span class="hs-identifier hs-var">getMCTSMove</span></a></span><span> </span><span class="annot"><span class="annottext">GameState
</span><a href="#local-6989586621679211054"><span class="hs-identifier hs-var">gameState</span></a></span><span> </span><span class="annot"><span class="annottext">Hiperparameters
</span><a href="#local-6989586621679211052"><span class="hs-identifier hs-var">hyperparameters</span></a></span><span> </span><span class="annot"><span class="annottext">Generator
</span><a href="#local-6989586621679211051"><span class="hs-identifier hs-var">generator</span></a></span><span>
</span><span id="line-312"></span></pre></body></html>